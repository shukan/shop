import{P as N,r as s,f as B,$ as m,i as q,as as z,T as v,at as T,au as M,av as S,aw as L,p as c,v as I,A as p,E as h,I as F,z as a,y as u,x as O,D as C,L as K,K as P}from"./index-21964c78.js";import{a as j,E as G}from"./form-item-8d3c5b0e.js";/* empty css               */import{E as H}from"./image-viewer-dd6920ac.js";/* empty css              */import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import"./castArray-18b00898.js";import"./_baseClone-42b68cca.js";import"./_Uint8Array-4a48d71f.js";import"./_initCloneObject-dc96d043.js";import"./debounce-6ea0a711.js";const Q=N({setup(){const e=s();let l=B({email:"",email_code:""});const E=s();let b=B({bind_id:"",verify_code:"",bind_type:2,rand_key:""});const k=B({email:[{required:!0,message:m("请输入邮箱地址"),trigger:"blur"}],email_code:[{required:!0,message:m("请输入邮箱验证码"),trigger:"blur"}]}),$=B({bind_id:[{required:!0,message:m("请输入邮箱地址"),trigger:"blur"}],verify_code:[{required:!0,message:m("请输入验证码"),trigger:"blur"}]}),n=s(!0),i=s(),y=s(60),r=s();let f=s(1),t=s(""),A=s(""),_=s(!1),D=()=>{let o={};if(!l.email){v.error(m("请输入邮箱号"));return}_.value||(_.value=!0,o.email=l.email,T(o).then(d=>{d.status==200?(_.value=!1,i.value||(r.value=y.value,n.value=!1,i.value=setInterval(()=>{r.value>0&&r.value<=y.value?(r.value--,console.log("count----",r)):(n.value=!0,clearInterval(i.value),i.value=null)},1e3)),v.success(m("验证码已经发生成功，请尽快输入验证码!"))):v.error(d.msg)}))},V=()=>{M({rand_key:l.rand_key}).then(o=>{if(o){let d=new FileReader;d.onload=function(g){t.value=g.target.result},d.readAsDataURL(o)}})};const R=o=>{o&&o.validate(d=>{if(d){console.log("submit!");var g={bind_access_token:l.email_code,email_bind_id:l.email};S(g).then(w=>{w.status==200?(v.success(m("邮箱绑定成功!")),f.value=1):v.error(w.msg)})}else return console.log("error submit!"),!1})},U=o=>{o&&o.validate(d=>{if(d)console.log("submit!"),L(b).then(g=>{g.status==200?(l.email=b.bind_id,f.value=2):v.error(g.msg)});else return console.log("error submit!"),!1})};return q(()=>{z().then(o=>{o.status==200&&(A.value=o.data.member_info.user_email)}),V()}),{ruleFormRef:e,ruleForm:l,rules:k,count:r,ishow:n,active:f,from:b,fromRef:E,rul:$,imgCode:t,user_email:A,loading:_,getCode:D,submitForm:R,nextStep:U,getImage:V}}});const W={style:{padding:"62px 168px"}},X={key:0,style:{"padding-bottom":"20px"}};function Y(e,l,E,b,k,$){const n=K,i=G,y=H,r=P,f=j;return c(),I("div",W,[e.user_email?(c(),I("div",X,p(e.$t("您已绑定邮箱："))+" "+p(e.user_email),1)):h("",!0),e.active==1?(c(),F(f,{key:1,ref:"fromRef",rules:e.rul,model:e.from,"label-position":"left","label-width":"120px"},{default:a(()=>[u(i,{label:e.$t("邮箱地址"),prop:"bind_id"},{default:a(()=>[u(n,{modelValue:e.from.bind_id,"onUpdate:modelValue":l[0]||(l[0]=t=>e.from.bind_id=t),class:"input-style",placeholder:e.$t("请输入邮箱地址")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(i,{label:e.$t("验证码"),prop:"verify_code"},{default:a(()=>[u(n,{modelValue:e.from.verify_code,"onUpdate:modelValue":l[1]||(l[1]=t=>e.from.verify_code=t),placeholder:e.$t("请输入证码"),class:"input-style"},{append:a(()=>[O("div",null,[u(r,{style:{padding:"0",width:"100px",display:"inherit"},onClick:e.getImage},{default:a(()=>[u(y,{class:"img-responsive",style:{height:"41px"},src:e.imgCode,fit:"cover",lazy:""},null,8,["src"])]),_:1},8,["onClick"])])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(i,{"label-width":"188px"},{default:a(()=>[u(r,{class:"form-item-reset-style",type:"primary",onClick:l[2]||(l[2]=t=>e.nextStep(e.fromRef))},{default:a(()=>[C(p(e.$t("下一步")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"])):h("",!0),e.active==2?(c(),F(f,{key:2,ref:"ruleFormRef",rules:e.rules,model:e.ruleForm,"label-position":"left","label-width":"120px"},{default:a(()=>[u(i,{label:e.$t("邮箱地址"),prop:"email"},{default:a(()=>[u(n,{modelValue:e.ruleForm.email,"onUpdate:modelValue":l[3]||(l[3]=t=>e.ruleForm.email=t),class:"input-style",disabled:"",placeholder:e.$t("请输入邮箱地址")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(i,{label:e.$t("验证码"),prop:"email_code"},{default:a(()=>[u(n,{modelValue:e.ruleForm.email_code,"onUpdate:modelValue":l[4]||(l[4]=t=>e.ruleForm.email_code=t),placeholder:e.$t("请输入邮箱验证码"),class:"input-style"},{append:a(()=>[e.ishow?(c(),F(r,{key:0,style:{padding:"0",width:"102px","font-size":"16px","background-color":"#21adea",color:"#fff",height:"45px"},loading:e.loading,onClick:e.getCode},{default:a(()=>[C(p(e.$t("获取验证码")),1)]),_:1},8,["loading","onClick"])):(c(),F(r,{key:1,style:{padding:"0",width:"102px","font-size":"16px","background-color":"#21adea",color:"#fff",height:"45px"}},{default:a(()=>[C(p(e.count)+" s "+p(e.$t("后获取")),1)]),_:1}))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(i,{"label-width":"188px"},{default:a(()=>[u(r,{class:"form-item-reset-style",type:"primary",onClick:l[5]||(l[5]=t=>e.submitForm(e.ruleFormRef))},{default:a(()=>[C(p(e.$t("确认绑定")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"])):h("",!0)])}const de=J(Q,[["render",Y],["__scopeId","data-v-5a424081"]]);export{de as default};
